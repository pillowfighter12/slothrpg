import random
import time
from monsters import *
from sloth import *
from inventory_potions_weapons import *
from inventory_potions_weapons import *
from inventory_potions_weapons import *
from inventory_potions_weapons import *


s_inventory = inventory()

def main():
    #sloth name is global so that you can recall it many places without having to pass the variable .   
    sloth_name = input("Enter your sloth name:")
    sloth = mainsloth(name=sloth_name, maxhp=100, hp=100, damage=20)
    print(f"Welcome {sloth_name}")
    welcome_message()
    path = path_choice()
    if path == "A":
        enter_cave(sloth)
    elif path == "B":
        follow_river(sloth)

def welcome_message():
    type_a = "\u0332".join("Type A:")
    type_b = "\u0332".join("Type B:")
    print(f"""You startle as you awaken on the ground with a broken branch next to you.
As you cumbersously investigate your surroundings you come across some foot prints and begin to follow.
Eventually you come across two pathes.
What path should you follow?
{type_a} +   To follow the path going towards the cave.
{type_b} +   To follow the path that follows the river.""")


def path_choice():
    while True:
        input_choice = input()
        if input_choice not in ["A", "B"]:
            print("Invalid input")
        else:
            return input_choice
    

        
def enter_cave(sloth):

    enemy_counter = 0
    enemy_index = None

    enemies = [{
        "monster": monster("Cave Spider",50, 15),
        "encounter_chance": 0.6,
        "pre_encounter_message": "The cave continues to get darker the deeper you go in",
        "time_lapse_min_value": 10,
        "time_lapse_max_value": 20,
        "after_encounter_message": "After defeating the cave spider you found a torch and some armor", 
    },

    {   
        "monster": monster("Cave monkey", 50, 20),
        "encounter_chance": 0.3,
        "pre_encounter_message": "The cave continues to get darker the deeper you go in",
        "time_lapse_min_value": 10,
        "time_lapse_max_value": 20,
        "after_encounter_message": "After defeating the cave spider you found a torch and some armor", 
    }]

    enemy_index = cave_enemy_selection(enemies)
    print(enemy_index)
    
    print("The cave seemed to be emitting something from within.")

    enemy = enemies[enemy_index]["monster"]
    enemy = enemies[enemy_counter]["monster"]
    
    print(enemies[enemy_counter]["pre_encounter_message"])
    enemy_counter = time_lapse(enemies[enemy_counter]["time_lapse_min_value"], enemies[enemy_counter]["time_lapse_max_value"], enemies[enemy_counter]["encounter_chance"], enemy, sloth, enemy_counter)
    print("You have encountered " + str(enemy_counter) + " enemys")
    print(enemies[enemy_counter]["after_encounter_message"])
    s_inventory.inv_options(sloth)


    enemy_index = cave_enemy_selection(enemies)

    print(enemy_index)

    print("The cave seemed to be emitting something from within.")
    print(enemies[enemy_index]["pre_encounter_message"])
    
    enemy_counter = time_lapse(enemies[enemy_index]["time_lapse_min_value"], enemies[enemy_index]["time_lapse_max_value"], enemies[enemy_index]["encounter_chance"], enemies[enemy_index]["monster"], sloth, enemy_index)
    print("You have encountered " + str(enemy_counter) + " enemys")
    print(enemies[enemy_index]["after_encounter_message"])
    s_inventory.inv_options(sloth)


def follow_river(sloth): 
    enemy = monster("Crocodile", 500)
    encounter_chance = 1                
    print("You followed the footsteps to the river")
    time_lapse(5, 15, encounter_chance, enemy, sloth) 

# Used to generate a random fight encounter in the cave 

def time_lapse(min_time, max_time, encounter_chance, enemy, sloth, enemy_counter,):
    for i in range(random.randint(min_time, max_time)):
        print(" . . . ")
        time.sleep(1)
        chance = random.random()
        print(chance)
        if chance >= encounter_chance or not enemy:
            print("You didn't encounter any enemies")
            continue
        print("A", enemy.name, "approaches!")
        enemy_counter += 1
        engage_fight(enemy, sloth, enemy_counter)
        print(enemy_counter)
        return enemy_counter
    



def engage_fight(enemy, sloth, enemy_counter):
    print("You have encountered a enemy!", enemy.name)
    damage = sloth.damage
    damage_taken = enemy.damage
    while sloth.hp > 0 and enemy.hp > 0:
        print("What would you like to do? ")

        choice = input()
        if choice not in ["A", "B", "C"]:
            print("Input must be A, B, or C")

        if choice == "A":
            enemy.hp -= damage
            print("You deal", damage, "damage to the", enemy.name)
            damage_taken = enemy.damage
            sloth.hp -= damage_taken
            print("You have taken", damage_taken, " damage to the face")
            print(sloth.name, sloth.hp)
            print(str(enemy.name) + " " + str(enemy.hp))
            if enemy.hp <= 0 and sloth.hp > 0:
                print("You defeated the " + enemy.name)
                print("******************")
                return True
            elif enemy.hp > 0 and sloth.hp <= 0:
                print(sloth.name + " has fainted and you must go back to the start")
                main()
                return True
            
            elif sloth.hp <= 0 and enemy.hp <= 0:
                print("You have both fainted and you must go back to the start!")
                main()
                return True
                
    return False

    # if enemy_counter == 1:
    #     enemy = monster("Cave Spider", 50, 25)
    #     encounter_chance = 0.6
    #     print("The cave continues to get darker the deeper you go in")
    #     enemy_counter = time_lapse(10, 20, encounter_chance, enemy, sloth, enemy_counter)
    #     print("After fending off the second Cave Spider you found a small elixer of life!")
    #     small_elixer = potions["small_elixer"]
    #     s_inventory.add_item(small_elixer)
    #     print("Small elixer was added to your inventory!")

    # s_inventory.inv_options(sloth)

    # if enemy_counter == 2:
    #     enemy = monster("Black Widow", 50 , 10)
    #     encounter_chance = 1
    #     print("You get to the end of the cave and a MASSIVE spider appears")
    #     enemy_counter = time_lapse(10, 20, encounter_chance, enemy, sloth, enemy_counter)
    #     print("You have encountered " + str(enemy_counter) + " enemys")
    #     print(enemy_counter)

    # s_inventory.inv_options(sloth)

#simple placeholder for where the current code ends

main()